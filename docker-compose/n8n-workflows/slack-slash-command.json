{
  "name": "Slack Slash Command Handler",
  "versionId": "slash-command-v1",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "slack/slash-command",
        "options": {
          "responseMode": "responseNode"
        }
      },
      "id": "webhook-trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "// Slack Ïä¨ÎûòÏãú Ïª§Îß®Îìú ÌååÏã±\nconst body = $input.item.json.body;\n\n// URL encoded form dataÎ•º ÌååÏã±\nconst params = {};\nif (typeof body === 'string') {\n  body.split('&').forEach(pair => {\n    const [key, value] = pair.split('=');\n    params[decodeURIComponent(key)] = decodeURIComponent(value || '').replace(/\\+/g, ' ');\n  });\n} else {\n  Object.assign(params, body);\n}\n\nconst command = params.command || '/claude';\nconst text = params.text || '';\nconst userId = params.user_id || '';\nconst userName = params.user_name || '';\nconst channelId = params.channel_id || '';\nconst responseUrl = params.response_url || '';\nconst triggerId = params.trigger_id || '';\n\n// Î™ÖÎ†πÏñ¥ ÌååÏã±\nconst parts = text.trim().split(/\\s+/);\nconst subCommand = parts[0]?.toLowerCase() || 'help';\nconst args = parts.slice(1).join(' ');\n\nreturn {\n  json: {\n    command,\n    subCommand,\n    args,\n    text,\n    userId,\n    userName,\n    channelId,\n    responseUrl,\n    triggerId\n  }\n};"
      },
      "id": "parse-command",
      "name": "Parse Slash Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ response_type: 'ephemeral', text: 'Ï≤òÎ¶¨ Ï§ë...' }) }}",
        "options": {}
      },
      "id": "ack-response",
      "name": "Acknowledge",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [650, 200]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.subCommand }}",
              "operation": "equals",
              "value2": "help"
            }
          ]
        }
      },
      "id": "is-help",
      "name": "Is Help?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Parse Slash Command').item.json.responseUrl }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'ephemeral', blocks: [ { type: 'header', text: { type: 'plain_text', text: 'Claude Flow ÎèÑÏõÄÎßê', emoji: true } }, { type: 'section', text: { type: 'mrkdwn', text: '*ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™ÖÎ†πÏñ¥:*\\n‚Ä¢ `/claude ask <ÏßàÎ¨∏>` - AIÏóêÍ≤å ÏßàÎ¨∏\\n‚Ä¢ `/claude review <ÏΩîÎìú>` - ÏΩîÎìú Î¶¨Î∑∞\\n‚Ä¢ `/claude fix <ÏÑ§Î™Ö>` - Î≤ÑÍ∑∏ ÏàòÏ†ï\\n‚Ä¢ `/claude gitlab mrs` - GitLab MR Î™©Î°ù\\n‚Ä¢ `/claude jira my` - ÎÇ¥ Jira Ïù¥Ïäà\\n‚Ä¢ `/claude project set <id>` - ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï\\n‚Ä¢ `/claude stats` - ÏÇ¨Ïö© ÌÜµÍ≥Ñ\\n‚Ä¢ `/claude help` - ÎèÑÏõÄÎßê' } }, { type: 'context', elements: [{ type: 'mrkdwn', text: '_Powered by Claude Flow_' }] } ] }) }}",
        "options": {}
      },
      "id": "send-help",
      "name": "Send Help",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1050, 200],
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.subCommand }}",
              "operation": "equals",
              "value2": "ask"
            }
          ]
        }
      },
      "id": "is-ask",
      "name": "Is Ask?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1050, 350]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8080/api/v1/execute-with-routing",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ prompt: $('Parse Slash Command').item.json.args, channel: $('Parse Slash Command').item.json.channelId, userId: $('Parse Slash Command').item.json.userId }) }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "execute-ask",
      "name": "Execute Ask",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1300, 300],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Parse Slash Command').item.json.responseUrl }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', blocks: [ { type: 'section', text: { type: 'mrkdwn', text: $json.result || $json.error || 'No response' } }, { type: 'context', elements: [{ type: 'mrkdwn', text: '_Agent: ' + ($json.routedAgent || 'general') + '_' }] } ] }) }}",
        "options": {}
      },
      "id": "send-ask-response",
      "name": "Send Ask Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1550, 300],
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.subCommand }}",
              "operation": "equals",
              "value2": "stats"
            }
          ]
        }
      },
      "id": "is-stats",
      "name": "Is Stats?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1050, 500]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "http://host.docker.internal:8080/api/v1/stats",
        "options": {}
      },
      "id": "fetch-stats",
      "name": "Fetch Stats",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1300, 500],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Parse Slash Command').item.json.responseUrl }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'ephemeral', blocks: [ { type: 'header', text: { type: 'plain_text', text: 'Claude Flow ÌÜµÍ≥Ñ', emoji: true } }, { type: 'section', fields: [ { type: 'mrkdwn', text: '*Ï¥ù Ïã§Ìñâ:*\\n' + $json.totalExecutions }, { type: 'mrkdwn', text: '*ÏÑ±Í≥µÎ•†:*\\n' + ($json.successRate * 100).toFixed(1) + '%' }, { type: 'mrkdwn', text: '*Ï¥ù ÌÜ†ÌÅ∞:*\\n' + $json.totalTokens.toLocaleString() }, { type: 'mrkdwn', text: '*ÌèâÍ∑† ÏãúÍ∞Ñ:*\\n' + ($json.avgDurationMs / 1000).toFixed(1) + 's' }, { type: 'mrkdwn', text: '*üëç:*\\n' + $json.thumbsUp }, { type: 'mrkdwn', text: '*üëé:*\\n' + $json.thumbsDown } ] } ] }) }}",
        "options": {}
      },
      "id": "send-stats",
      "name": "Send Stats",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1550, 500],
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.subCommand }}",
              "operation": "equals",
              "value2": "gitlab"
            }
          ]
        }
      },
      "id": "is-gitlab",
      "name": "Is GitLab?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1050, 650]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "http://host.docker.internal:8080/api/v1/plugins/gitlab/mrs",
        "options": {}
      },
      "id": "fetch-gitlab-mrs",
      "name": "Fetch GitLab MRs",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1300, 650],
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const result = $input.item.json;\nconst responseUrl = $('Parse Slash Command').item.json.responseUrl;\n\nlet mrList = '';\nif (result.success && result.data) {\n  for (const mr of result.data.slice(0, 5)) {\n    mrList += `‚Ä¢ <${mr.web_url}|!${mr.iid}> ${mr.title} (by ${mr.author})\\n`;\n  }\n} else {\n  mrList = result.error || 'No MRs found';\n}\n\nreturn {\n  json: {\n    responseUrl,\n    body: {\n      response_type: 'ephemeral',\n      blocks: [\n        {\n          type: 'header',\n          text: { type: 'plain_text', text: 'GitLab Open MRs', emoji: true }\n        },\n        {\n          type: 'section',\n          text: { type: 'mrkdwn', text: mrList || 'No open MRs' }\n        }\n      ]\n    }\n  }\n};"
      },
      "id": "format-gitlab",
      "name": "Format GitLab Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1550, 650]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.responseUrl }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.body) }}",
        "options": {}
      },
      "id": "send-gitlab",
      "name": "Send GitLab Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1800, 650],
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.subCommand }}",
              "operation": "equals",
              "value2": "jira"
            }
          ]
        }
      },
      "id": "is-jira",
      "name": "Is Jira?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1050, 800]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "http://host.docker.internal:8080/api/v1/plugins/jira/my-issues",
        "options": {}
      },
      "id": "fetch-jira-issues",
      "name": "Fetch Jira Issues",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1300, 800],
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const result = $input.item.json;\nconst responseUrl = $('Parse Slash Command').item.json.responseUrl;\n\nlet issueList = '';\nif (result.success && result.data) {\n  for (const issue of result.data.slice(0, 5)) {\n    const status = issue.status || 'Unknown';\n    issueList += `‚Ä¢ <${issue.url}|${issue.key}> ${issue.summary} [${status}]\\n`;\n  }\n} else {\n  issueList = result.error || 'No issues found';\n}\n\nreturn {\n  json: {\n    responseUrl,\n    body: {\n      response_type: 'ephemeral',\n      blocks: [\n        {\n          type: 'header',\n          text: { type: 'plain_text', text: 'ÎÇ¥ Jira Ïù¥Ïäà', emoji: true }\n        },\n        {\n          type: 'section',\n          text: { type: 'mrkdwn', text: issueList || 'No assigned issues' }\n        }\n      ]\n    }\n  }\n};"
      },
      "id": "format-jira",
      "name": "Format Jira Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1550, 800]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.responseUrl }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.body) }}",
        "options": {}
      },
      "id": "send-jira",
      "name": "Send Jira Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1800, 800],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Parse Slash Command').item.json.responseUrl }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'ephemeral', text: 'Ïïå Ïàò ÏóÜÎäî Î™ÖÎ†πÏñ¥ÏûÖÎãàÎã§. `/claude help`Î•º ÏûÖÎ†•ÌïòÏó¨ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™ÖÎ†πÏñ¥Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.' }) }}",
        "options": {}
      },
      "id": "send-unknown",
      "name": "Send Unknown Command",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1300, 950],
      "continueOnFail": true
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [{ "node": "Parse Slash Command", "type": "main", "index": 0 }]
      ]
    },
    "Parse Slash Command": {
      "main": [
        [
          { "node": "Acknowledge", "type": "main", "index": 0 },
          { "node": "Is Help?", "type": "main", "index": 0 }
        ]
      ]
    },
    "Is Help?": {
      "main": [
        [{ "node": "Send Help", "type": "main", "index": 0 }],
        [{ "node": "Is Ask?", "type": "main", "index": 0 }]
      ]
    },
    "Is Ask?": {
      "main": [
        [{ "node": "Execute Ask", "type": "main", "index": 0 }],
        [{ "node": "Is Stats?", "type": "main", "index": 0 }]
      ]
    },
    "Execute Ask": {
      "main": [
        [{ "node": "Send Ask Response", "type": "main", "index": 0 }]
      ]
    },
    "Is Stats?": {
      "main": [
        [{ "node": "Fetch Stats", "type": "main", "index": 0 }],
        [{ "node": "Is GitLab?", "type": "main", "index": 0 }]
      ]
    },
    "Fetch Stats": {
      "main": [
        [{ "node": "Send Stats", "type": "main", "index": 0 }]
      ]
    },
    "Is GitLab?": {
      "main": [
        [{ "node": "Fetch GitLab MRs", "type": "main", "index": 0 }],
        [{ "node": "Is Jira?", "type": "main", "index": 0 }]
      ]
    },
    "Fetch GitLab MRs": {
      "main": [
        [{ "node": "Format GitLab Response", "type": "main", "index": 0 }]
      ]
    },
    "Format GitLab Response": {
      "main": [
        [{ "node": "Send GitLab Response", "type": "main", "index": 0 }]
      ]
    },
    "Is Jira?": {
      "main": [
        [{ "node": "Fetch Jira Issues", "type": "main", "index": 0 }],
        [{ "node": "Send Unknown Command", "type": "main", "index": 0 }]
      ]
    },
    "Fetch Jira Issues": {
      "main": [
        [{ "node": "Format Jira Response", "type": "main", "index": 0 }]
      ]
    },
    "Format Jira Response": {
      "main": [
        [{ "node": "Send Jira Response", "type": "main", "index": 0 }]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  }
}
